<group name="red_lantern.rpki_cover_hijack">
  <!-- RPKI cover hijack: step 1 - BMP announcement observed -->
  <rule id="96001" level="5">
    <decoded_as>red_lantern_bmp_announcement_decoder</decoded_as>
    <description>Red Lantern | rpki_cover_hijack | BMP announcement observed</description>
    <group>red_lantern.bgp,correlation</group>
    <options>no_full_log</options>
    <field name="bmp_event_type" type="pcre2">announce</field>
    <event_correlation>
      <rule_id>96002</rule_id>
      <timeframe>3600</timeframe> <!-- allow 1 hour for validation -->
      <count>1</count>
    </event_correlation>
  </rule>

  <!-- RPKI cover hijack: step 2 - announcement validated by RPKI -->
  <rule id="96002" level="7">
    <decoded_as>red_lantern_rpki_decoder</decoded_as>
    <description>Red Lantern | rpki_cover_hijack | RPKI validation confirmed</description>
    <group>red_lantern.rpki,correlation</group>
    <options>no_full_log</options>
    <field name="rpki.state" type="pcre2">VALID</field>
    <field name="rpki.prefix" type="pcre2">.*</field>
    <field name="rpki.origin_as" type="pcre2">.*</field>
    <event_correlation>
      <rule_id>96003</rule_id>
      <timeframe>86400</timeframe> <!-- allow for asynchronous validator confirmation -->
      <count>1</count>
    </event_correlation>
  </rule>

  <!-- RPKI cover hijack: step 3 - BMP withdrawal observed -->
  <rule id="96003" level="8">
    <decoded_as>red_lantern_bmp_withdrawal_decoder</decoded_as>
    <description>Red Lantern | rpki_cover_hijack | BMP withdrawal observed</description>
    <group>red_lantern.bgp,correlation</group>
    <options>no_full_log</options>
    <field name="bmp_event_type" type="pcre2">withdraw</field>
    <field name="bmp.prefix" type="pcre2">.*</field>
    <field name="bmp.origin_as" type="pcre2">.*</field>
    <event_correlation>
      <rule_id>96002</rule_id>
      <timeframe>172800</timeframe> <!-- withdrawals may occur up to 2 days later -->
      <count>1</count>
    </event_correlation>
  </rule>
</group>
