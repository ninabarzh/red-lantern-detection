<group name="red_lantern.roa_poisoning">
  <!-- ROA poisoning: step 1 - RPKI state observed as valid -->
  <rule id="95001" level="5">
    <decoded_as>red_lantern_rpki_decoder</decoded_as>
    <description>Red Lantern | roa_poisoning | RPKI validation observed</description>
    <group>red_lantern.rpki,correlation</group>
    <options>no_full_log</options>
    <field name="rpki.state" type="pcre2">VALID</field>
    <field name="rpki.prefix" type="pcre2">.*</field>
    <field name="rpki.origin_as" type="pcre2">.*</field>
    <event_correlation>
      <rule_id>95002</rule_id>
      <timeframe>86400</timeframe> <!-- allow for asynchronous validator updates -->
      <count>1</count>
    </event_correlation>
  </rule>

  <!-- ROA poisoning: step 2 - multiple validators confirmation -->
  <rule id="95002" level="7">
    <decoded_as>red_lantern_rpki_decoder</decoded_as>
    <description>Red Lantern | roa_poisoning | Multiple validator confirmation</description>
    <group>red_lantern.rpki,correlation</group>
    <options>no_full_log</options>
    <field name="rpki.state" type="pcre2">VALID</field>
    <field name="rpki.prefix" type="pcre2">.*</field>
    <field name="rpki.origin_as" type="pcre2">.*</field>
    <event_correlation>
      <rule_id>95003</rule_id>
      <timeframe>86400</timeframe>
      <count>2</count> <!-- Require at least 2 validator confirmations -->
    </event_correlation>
  </rule>

  <!-- ROA poisoning: optional authentication context -->
  <rule id="95003" level="8">
    <decoded_as>red_lantern_auth_decoder</decoded_as>
    <description>Red Lantern | roa_poisoning | Optional registry/admin auth</description>
    <group>red_lantern.auth,correlation</group>
    <options>no_full_log</options>
    <field name="user_action">roa_creation</field>
    <event_correlation>
      <rule_id>95002</rule_id>
      <timeframe>86400</timeframe>
      <count>1</count>
    </event_correlation>
  </rule>
</group>
